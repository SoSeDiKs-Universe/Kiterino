From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: SoSeDiK <mrsosedik@gmail.com>
Date: Mon, 24 Oct 2022 18:51:55 +0300
Subject: [PATCH] Get destroy speed from BlockData


diff --git a/src/main/java/org/bukkit/craftbukkit/block/data/CraftBlockData.java b/src/main/java/org/bukkit/craftbukkit/block/data/CraftBlockData.java
index 1fefe185800dd48dd328697127405e0844543e5e..07493307de9f2a181008635b96c90a54c959bc11 100644
--- a/src/main/java/org/bukkit/craftbukkit/block/data/CraftBlockData.java
+++ b/src/main/java/org/bukkit/craftbukkit/block/data/CraftBlockData.java
@@ -631,4 +631,28 @@ public class CraftBlockData implements BlockData {
         return !state.requiresCorrectToolForDrops() || nms.isCorrectToolForDrops(state);
     }
     // Paper end
+
+    // Kiterino start
+    @Override
+    public float getDestroySpeed(org.bukkit.inventory.ItemStack itemStack, boolean considerEnchants) {
+        net.minecraft.world.item.ItemStack nmsItemStack;
+        if (itemStack instanceof org.bukkit.craftbukkit.inventory.CraftItemStack craftItemStack) {
+            nmsItemStack = craftItemStack.handle;
+            if (nmsItemStack == null) {
+                nmsItemStack = net.minecraft.world.item.ItemStack.EMPTY;
+            }
+        } else {
+            nmsItemStack = org.bukkit.craftbukkit.inventory.CraftItemStack.asNMSCopy(itemStack);
+        }
+        float speed = nmsItemStack.getDestroySpeed(state);
+        if (speed > 1.0F && considerEnchants) {
+            int enchantLevel = net.minecraft.world.item.enchantment.EnchantmentHelper.getItemEnchantmentLevel(net.minecraft.world.item.enchantment.Enchantments.BLOCK_EFFICIENCY, nmsItemStack);
+            if (enchantLevel > 0) {
+                speed += enchantLevel * enchantLevel + 1;
+            }
+        }
+        return speed;
+    }
+    // Kiterino end
+
 }
