From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: SoSeDiK <mrsosedik@gmail.com>
Date: Wed, 8 Jun 2022 13:03:53 +0300
Subject: [PATCH] Support recipe grid for AItems


diff --git a/src/main/java/net/minecraft/world/entity/player/StackedContents.java b/src/main/java/net/minecraft/world/entity/player/StackedContents.java
index 842b921799111789b37a34b76644c9217bc85794..12c84c6973842a5f7234895be95d7cc1b717848e 100644
--- a/src/main/java/net/minecraft/world/entity/player/StackedContents.java
+++ b/src/main/java/net/minecraft/world/entity/player/StackedContents.java
@@ -57,6 +57,21 @@ public class StackedContents {
                 if (a == null || b == null) {
                     return false;
                 }
+                // Kiterino start
+                var compound = a.getTag();
+                String namespace = org.bukkit.Bukkit.getName();
+                if (compound != null && compound.contains(namespace)) {
+                    compound = compound.getCompound(namespace);
+                    if (compound.contains("Id")) {
+                        var compound1 = b.getTag();
+                        if (compound1 == null) return false;
+                        if (!compound1.contains(namespace)) return false;
+                        compound1 = compound1.getCompound(namespace);
+                        if (!compound1.contains("Id")) return false;
+                        return compound.getString("Id").equals(compound1.getString("Id"));
+                    }
+                }
+                // Kiterino end
                 return ItemStack.tagMatches(a, b);
             }
         });
diff --git a/src/main/java/net/minecraft/world/item/crafting/Ingredient.java b/src/main/java/net/minecraft/world/item/crafting/Ingredient.java
index 07218093a085293f87d8e562f100688580bdd343..ed643bd24c1cf3baf74e19f6ccff3581badba503 100644
--- a/src/main/java/net/minecraft/world/item/crafting/Ingredient.java
+++ b/src/main/java/net/minecraft/world/item/crafting/Ingredient.java
@@ -54,7 +54,7 @@ public final class Ingredient implements Predicate<ItemStack> {
                 return recipeitemstack_provider.getItems().stream();
                 // PaperPR start
             }).distinct().peek(stack -> {
-                stack.isExactRecipeIngredient = this.exact;
+                stack.isExactRecipeIngredient = this.exact || this.kItem; // Kiterino
             }).toArray((i) -> {
                 // PaperPR end
                 return new ItemStack[i];
